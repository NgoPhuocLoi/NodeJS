<style>
    *{
        margin: 0;padding: 0;
    }
    .chemicalEqt-list{
        list-style: none;
        width: 100%;
        margin-top: 20px;
    }

    .chemicalEqt-item{
        padding: 12px;
        border-bottom: 1px solid #ccc;
        position: relative;
    }

    .delete-btn{
        position: absolute;
        width: 20px;
        height: 20px;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        background-color: red;
        top: 0;
        right: 0;
    }
    h4{margin: 0;}
</style>
<div class="mt-4">
    <form method="POST" action="/chemicalEqt/store"> 
        <div class="form-group">
            <label for="reagent">Reagent</label>
            <input type="text" name="reagent" class="form-control" id="reagent">
        </div>
        <div class="form-group">
            <label for="product">Product</label>
            <input type="text" name="product" class="form-control" id="product">
        </div>
        

        <button type="submit" class="btn btn-dark">Search</button>
    </form>
</div>

<ul class="chemicalEqt-list">
    
</ul>

<div class="data-list">
    {{#each chemicalEqts}}
        <div reagent="{{this.reagent}}" product="{{this.product}}" id="{{this._id}}" class="input"></div>
    {{/each}}
</div>

<form method="POST" class="delete-form"></form>

<script>
    function transformChemical(chemicalList, characterList){
        const newArr = []
        let count = 0

        chemicalList = chemicalList.map(item => item.toUpperCase())
        characterList = characterList.map(item => item.toUpperCase())
        
        chemicalList.forEach(item => {
          characterList.forEach(cha => {
            if(item.includes(cha)) {
              count++
            
              item = item.replace(cha,cha.replace(cha[1], cha[1].toLowerCase()))
              
              newArr.push(item)
            }
            })
          if(count === 0) newArr.push(item.toUpperCase())
          count = 0
        })
        newArr.forEach((item, index )=> {
            characterList.forEach(cha => {
              if(item.includes(cha)) {
                newArr.splice(newArr.indexOf(item), 1)
              }
            })
            
        })
        return newArr   
      }
</script>

<script>
    const chemicalList = []
    const dataList = document.querySelectorAll(".input")
    const chemicalEqtList = document.querySelector(".chemicalEqt-list")
    let arr1 = [], arr2 = []
    let sample = ['mn', 'ba', 'cl', 'na','fe']
    dataList.forEach(data => {
        arr1.push(data.getAttribute("reagent").split(" "))
        arr2.push(data.getAttribute("product").split(" "))
    })

    arr1 = arr1.map(item => transformChemical(item,sample))
    arr2 = arr2.map(item => transformChemical(item,sample))
    arr1.forEach((item, index) => {
        console.log(dataList[index].getAttribute("id"))
        chemicalList.push({
            id: dataList[index].getAttribute("id") ,
            reagent: item.join(" ").replace(/{/gi, '_{').replace(/\(/g, '').replace(/\)/g, '').replace(/\[/g, '{').replace(/\]/g, '}'),
            product: arr2[index].join(" ").replace(/{/gi, '_{').replace(/\(/g, '').replace(/\)/g, '').replace(/\[/g, '{').replace(/\]/g, '}'),
        })
        console.log(chemicalList[index].reagent)
        console.log(chemicalList[index].product)

    })

    const html = chemicalList.map(item => {
        return `
            <li class="chemicalEqt-item">
                <h4>\\(${item.reagent} \\to ${item.product}\\)</h4>
                <button class="delete-btn" id="${item.id}">X</button>
            </li>
        `
    }).join("")

    chemicalEqtList.innerHTML = html

</script>

<script>
    const submitBtn = document.querySelector('.submit-btn')
    const deleteBtns = document.querySelectorAll('.delete-btn')
    const deleteForm = document.querySelector('.delete-form')
    console.log(deleteBtns)
    deleteBtns.forEach(btn => {
        btn.addEventListener('click', function(){
            const chemicalEqtId = btn.getAttribute("id")
            deleteForm.action = `/chemicalEqt/${chemicalEqtId}/force?_method=DELETE `
            deleteForm.submit()
    })
    })
    
</script>